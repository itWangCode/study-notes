# 作用域

[JavaScript深入理解之作用域链](http://cavszhouyou.top/JavaScript%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E4%B9%8B%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE.html)

[深入理解闭包之前置知识→作用域与词法作用域](https://juejin.cn/post/6844903606311714824)

[面试官：说说作用域和闭包吧](https://juejin.cn/post/6844904165672484871)

作用域就是一套规则，用于确定在何处以及如何 **查找变量（标识符）** 的规则”

## 函数作用域  

```js
function foo() {
 var a = 'iceman';
 console.log(a); // 输出"iceman"
}
foo();
```

含义是指，属于这个函数的全部变量都可以在整个函数的范围内使用及复用（事实上在嵌套的作用域中也可以使用）。例如：（var）

外部无法访问内部，内部可以访问外部（逐层向外寻找）

函数的作用域在函数创建时就已经确定了。当函数创建时，会有一个名为 `[[Scopes]]` 的内部属性保存`所有父变量对象`到其中。当函数执行时，会创建一个执行环境，然后通过复制函数的 [[Scopes]]  属性中的对象构建起执行环境的作用域链，然后，变量对象 VO 被激活生成 AO 并添加到作用域链的前端，完整作用域链创建完成：

在任意代码片段外部添加包装函数，可以将内部的变量和函数定义“隐藏”起来，外部作用域无法访问包装函数内部的任何内容。函数声明和函数表达式之间最重要的区别是它们的名称标识符将会绑定在何处。

```javascript
(function foo(){ // <-- 添加 这 一行  
//不行。 foo 变量 名 被 隐藏 在 自身 中， 不会 非必要 地 污染 外部 作用域。
  var a = 3;
  console. log( a ); // 3
})(); // <-- 以及 这 一行
```

## 全局作用域

```js
var b = 'programmer';
function foo() {
 console.log(b); // 输出"programmer"
}
foo();
```

## 作用域链

当代码在一个环境中执行时，会创建变量对象的一个作用域链。作用域链的用途是保证对执行环境有权访问的所有变量和函数的有序访问。

通过作用域链，我们可以访问到外层环境的变量和函数。

作用域 规定了如何查找变量，也就是确定当前执行代码对变量的访问权限。当查找变量的时候，会先从当前上下文的变量对象中查找，如果没有找到，就会从父级（词法层面上的父级）执行上下文的变量对象中查找，一直找到全局上下文的变量对象，也就是全局对象。这样由多个执行上下文的变量对象构成的链表就叫做 作用域链。

变量对象里边包含了执行上下文中所有变量和函数的声明，它的作用就是保证代码执行时对变量和函数的正确访问。如果在该变量对象中没有找到对应变量或函数，则会根据执行作用域链向上继续查找，

作用域链本质上是一个指向变量对象的指针列表（在文中我们使用数组表示），它只引用但不实际包含变量对象。

作用域链的前端始终都是当前执行上下文的变量对象，如果这个执行上下文属于函数执行上下文，则用活动对象作为变量对象。

全局执行上下文的变量对象（也就是全局对象）始终是作用域链的最后一个对象

## 词法作用域

词法作用域: 是由你在写代码时将变量和块作用域写在哪里来决定的。即： 无论函数在哪里被调用，也无论它如何被调用，它的词法作用域都只由函数被声明时所处的位置决定。

词法作用域是作用域的一种工作模型

编译时，而非运行时

```javascript
function foo() {
  console. log( a ); // 会输出2
}

function bar() {
  var a = 3; 
  foo();
}

var a = 2;
bar();
```

## 块级作用域

块级作用域： 在一个代码块（括在一对花括号中的一组语句）中定义的所有变量在代码块的外部是不可见的

es5， Javascript 并不支持块级作用域,就是因为有变量提升

块级声明用于声明在指定块的作用域之外无法访问的变量。

块级作用域的形式:

1. 函数内部

2. 块中(字符 { 和 } 之间的区域)

## 动态作用域

动态 作用域 并不 关心 函数 和 作用域 是 如何 声明 以及 在何处 声明 的， 只 关心 它们 从何 处 调用。 换句话说， 作用域 链 是 基于 调用 栈 的， 而 不是 代码 中的 作用域 嵌套。  

需要 明确 的 是， 事实上 JavaScript 并不 具有 动态 作用域。 它 只有 词法 作用域， 简单 明了。 但是 this 机制 某种程度 上 很像 动态 作用域。  
主要 区别： 词法 作用域 是在 写 代码 或者说 定义 时 确定 的， 而 动态 作用域 是在 运行时 确定 的。（ this 也是！） 词法 作用域 关注 函数 在何处 声明， 而 动态 作用域 关注 函数 从何 处 调用。
