# z-index

[彻底搞懂CSS层叠上下文、层叠等级、层叠顺序、z-index](https://juejin.im/post/6844903667175260174)

<https://juejin.im/post/5b876f86518825431079ddd6>

z-index属性值并不是在任何元素上都有效果。它仅在定位元素（定义了position属性，且属性值为非static值的元素）上有效果。

判断元素在Z轴上的堆叠顺序，不仅仅是直接比较两个元素的z-index值的大小，这个堆叠顺序实际由元素的层叠上下文、层叠等级共同决定。

## 层叠上下文

如果一个元素含有层叠上下文，(也就是说它是层叠上下文元素)，我们可以理解为这个元素在Z轴上就“高人一等”，最终表现就是它离屏幕观察者更近。

### 一般有3种创建层叠上下文的方法

1. HTML中的根元素本身j就具有层叠上下文，称为“根层叠上下文”。

2. 普通元素设置 position 属性为非 static 值并设置 z-index 属性为具体数值(非auto)，产生层叠上下文。

3. CSS3中的新属性也可以产生层叠上下文。

你可以把层叠上下文元素理解为理解为该元素当了官，而其他非层叠上下文元素则可以理解为普通群众。凡是“当了官的元素”就比普通元素等级要高，也就是说元素在Z轴上更靠上，更靠近观察者。

### css3 新属性产生层叠上下文

```
父元素的display属性值为flex | inline-flex，子元素z-index属性值不为auto的时候，子元素为层叠上下文元素；

元素的opacity属性值不是1；

元素的transform属性值不是none；

元素 mix-blend-mode 属性值不是normal`；

元素的filter属性值不是none；

元素的isolation属性值是isolate；

will-change 指定的属性值为上面任意一个；

元素的-webkit-overflow-scrolling属性值设置为touch。
```

CSS3中，元素属性满足以上条件之一，就会产生层叠上下文。我们用第1条来做一个简单的解释说明。

## 层叠等级

层叠等级:

在同一个层叠上下文中，它描述定义的是该层叠上下文中的层叠上下文元素在Z轴上的上下顺序。

在其他普通元素中，它描述定义的是这些普通元素在Z轴上的上下顺序。

特点：

普通元素的层叠等级优先由其所在的层叠上下文决定。

层叠等级的比较只有在当前层叠上下文元素中才有意义。不同层叠上下文中比较层叠等级是没有意义的。

## 层叠顺序

“层叠顺序”(stacking order)表示元素发生层叠时按照特定的顺序规则在Z轴上垂直显示。

层叠顺序图：<https://image-static.segmentfault.com/911/542/911542058-5ab466a10ee63_articlex>

## 结论

```
1、首先先看要比较的两个元素是否处于同一个层叠上下文中：
  1.1 如果是，谁的层叠等级大，谁在上面（怎么判断层叠等级大小呢？——看“层叠顺序”图）。
  1.2 如果两个元素不在统一层叠上下文中，请先比较他们所处的层叠上下文的层叠等级。
2、当两个元素层叠等级相同、层叠顺序相同时，在DOM结构中后面的元素层叠等级在前面元素之上。
```
